## RAG模型发展

### RAG局限性（native rag）

1. **检索阶段的挑战（Retrieval Challenges）**：

   它经常会选择不太相关的内容，漏掉关键的信息，从而导致后续生成阶段无法准确反映所需信息。这可能会让模型生成出脱离实际问题的内容。

2. **生成阶段的困难（Generation Difficulties）**：

   在生成回答时，RAG模型可能会出现所谓的“幻觉”（hallucination）问题，也就是生成一些没有根据的内容。由于模型可能会将<u>不相关的信息</u>混入生成内容中，从而导致结果中可能含有一些有偏见、不恰当或甚至有害的内容，从而降低了答案的质量和可靠性。

3. **单次检索的局限性**：

   RAG模型在处理复杂任务时，单次检索的信息量往往不足以满足生成优质回答的需求。此外，由于生成模型可能过于依赖检索到的信息，导致最终的输出有时只是对检索内容的简单复述，而缺少深入的分析或独到的见解。

### Advanced RAG

1. 检索阶段的改进。

   * 索引优化

     为了让检索系统更好地理解内容，Advanced RAG在<u>索引建立时</u>（在查的时候要索引的那些列）进行精细化分割，在处理大量文本数据时，如果直接把一大块信息放入索引（也就是类似数据库的结构），模型很容易找不到真正相关的部分。Advanced RAG通过“精细化分割”和“滑动窗口”方法，按小段来组织信息，这样即使内容很长，模型也能更精准地找到对应的句子或段落。

     ​	:sailboat:*举个例子*：假设有一段文章包含多个主题，滑动窗口会把文章按小段滑动分隔（比如，每隔一句话分一段），这样不同主题的内容都能独立被索引，提升了模型找到细节的概率。

     元数据就是给信息添加的“标签”或“附加信息”。这些标签帮助模型更清楚内容的背景、类型或话题。

     ​	:sailboat:*举个例子：*假设一段内容和“历史事件”有关，而另一段是“科学研究”，加入元数据可以标记出每段的主题类别，模型在查找时就会优先匹配同类内容，避免不相关的信息混入。

   * 查询优化：通过对原始查询进行改写、扩展（query rewriting, query expansion等），让模型更清楚用户的需求，从而更好地检索相关内容。

2. 后检索阶段的优化：检索完成后，Advanced RAG会对找到的内容进一步处理，保证生成时能高效使用这些信息。这包括：

   * **内容重排序（reranking）**：Advanced RAG会将最相关的内容优先放在检索结果的最前面，以确保模型优先处理这些核心内容。这样，模型生成的回答能够更加准确和针对性。
   * **上下文压缩（context compressing）**：直接将所有信息传递给模型，可能会导致“信息过载”（信息量太大、重要信息被稀释）。为了解决这个问题，Advanced RAG会筛选和压缩信息，只保留与回答密切相关的部分，确保回答简洁而不失重点。

### Modular RAG

:pager:为什么要提出

1. 应对信息多样性与数据源复杂性

   传统RAG系统通常固定某一特点的数据源或检索方式上，难以满足多样化的数据需求。尤其在领域广泛或复杂的任务中。

   模块化解决：模块化RAG可以灵活地加载和调用各个模块，，如**Search**模块可以整合不同的数据源（如搜索引擎、知识图谱等），实现跨数据源检索。这使得系统具备更高的适应性，能够根据场景需求动态调整，提升检索和生成的效果。

2. 提升系统的可扩展性与维护性

   随着系统需求的增加，传统RAG的单一架构难以扩展和维护。要改进某个特定功能（如检索策略），往往需要重构整个系统，耗费大量人力和时间。

   * :leaves:例子：假设正在为一个慢病管理系统构建一个基于RAG的解决方案，这个系统需要从大量的医学文献、患者健康记录和实时医疗数据中检索信息

     传统RAG系统的困境：

     * :satellite:**检索模块（Retriever Module）**：负责从大规模的文献或数据库中获取相关信息，并将这些信息传递给生成模块。假设这个模块的算法被调整，比如引入了更复杂的相似性计算方法。
     * :satellite:**生成模块（Predict Module）**：依赖检索模块提供的信息来生成用户需要的文本内容。如果检索模块的输出格式、内容结构或信息丰富度发生变化，生成模块可能需要相应地调整，以确保能够正确解析并使用这些数据。

     模块化RAG系统的灵活性：在模块化RAG架构中，系统被分成了多个独立的模块。例如，有一个memory（记忆）专门存储患者的历史健康信息，一个search模块用于从医学文献中快速找到相关研究，还有一个predict生成模块负责根据检索结果生成个性化的健康建议。

     **实际改进**：如果我们发现系统的搜索功能不够强，无法有效检索到最新的医学研究，可以单独对**Search模块**进行优化，比如加入更先进的搜索算法或增加新的医学数据库支持。这个过程不会影响到**Memory模块**或**Predict模块**，它们依旧可以正常工作。

3. 支持多任务和个性化处理

   RAG系统在应用于不同任务时，面临不同的上下文需求。例如，在客户服务场景中，系统需要快速处理多种用户查询，而在科学研究中则要求深入分析和检索。

   模块化解决：模块化RAG通过引入**Task Adapter**模块，可以为不同任务定制适合的检索和生成策略。这意味着系统可以为每个任务动态配置最优模块，从而提高整体的响应能力和准确性。例如，**Memory**模块可以记录用户的历史交互，以提供更加个性化的服务，而**Routing**模块可以根据任务选择最优的数据流路径。

4. 提高模型生成的准确性与相关性

   传统RAG系统在生成回答时容易受到冗余信息的干扰，导致生成的内容相关性和准确性较低，特别是在长文本和多层次的知识检索场景中。

   **模块化解决**：模块化RAG通过**RAGFusion**模块进行多重查询策略的优化，结合**Memory**模块的长期记忆功能，有效减少生成内容的冗余，并提高上下文的相关性。这种设计确保了模型不仅能够检索到显性信息，还能挖掘隐性关联知识，从而生成更加精准和丰富的回答。

##### 各个模块的机制

1. `搜索模块`

2. `生成模块`

3. `记忆模块`

   在实际应用中，记忆模块的运作方式可以分为几个阶段：

   | 阶段     | 描述                                                         |
   | -------- | ------------------------------------------------------------ |
   | 信息采集 | 在查询过程中，RAG会将相关信息存入记忆池，以备后续查询或生成时调用。记忆模块会自动判断哪些信息是需要保留的。 |
   | 信息筛选 | 在信息采集后，记忆模块会进行过滤，保留高价值的、能够丰富上下文的内容，而非所有信息都进入记忆池，这样避免了冗余。 |
   | 自我增强 | 记忆模块通过多轮学习，不断调整和优化所存储的信息，使得未来的检索结果与存储的记忆更一致，避免重复性低的信息干扰。 |
   | 信息调用 | 在检索和生成过程中，记忆模块根据需要调用相关记忆，帮助生成更具上下文相关性的内容。这类似于人类在对话中基于过往记忆进行联想。 |

   :musical_keyboard:适合那些需要长时记忆和持续优化的任务。核心是：

   * **动态存储**允许模型在变化的任务需求下逐步调整其记忆内容，以确保模型始终拥有最新、最相关的信息。

   * **自我优化**则保证了模型能够根据过去的查询和生成历史逐步适应用户的需求，从而产生更加个性化的反馈。	

     * 分析和总结历史数据

       | 记忆模块会定期对已经存储的历史数据进行分析，总结哪些信息是高价值的、与当前任务最相关的，并标记或调整低价值的信息。这个过程有点像一个人回忆过去，选择记住重要的经历，而忽略不再相关的细节。 | **实例**：在慢病管理场景中，假如患者的健康记录已经存储在记忆模块中，模块会分析哪些信息是医生多次查询和使用的，比如关键的治疗数据或诊断报告。这些信息会被标记为“高价值”，以确保优先保留并在未来检索时更快获取。 |
       | ------------------------------------------------------------ | ------------------------------------------------------------ |

     * 根据新信息优化存储策略

       | 当有新的信息进入记忆模块时，模块会自动评估这些信息与现有记忆内容的关联性。如果新信息与旧信息有强相关性，模块可能会整合或优化它们；如果新信息带来了重要的、以前没有覆盖的知识，模块会调整存储策略，以便能更好地反映最新数据的分布。 | 在医疗领域，当患者的新体检数据上传到系统中时，记忆模块会评估这些数据是否与以往的健康记录存在矛盾，或者是否揭示了新的健康趋势。如果新数据证实了某个健康趋势，模块会调整记忆结构，以更高的优先级存储这些重要信息。 |
       | ------------------------------------------------------------ | ------------------------------------------------------------ |

     * 自我增强

       | 记忆模块会进行**多轮的自我学习**，类似于不断优化的机器学习模型。每次有新的数据加入或查询任务完成后，模块会更新其内部模型，并重新评估数据分布，使得未来的检索和生成能够更加贴近当前的任务需求。 | 假设医生多次查询患者的血糖数据，模块会逐渐“学习”到血糖数据在这个患者的健康管理中极其重要，未来会优先提供相关信息。如果医生后来多次查询心脏健康记录，模块也会调整优先级，动态优化记忆内容的分布，以适应新的查询模式。 |
       | ------------------------------------------------------------ | ------------------------------------------------------------ |

   :sailboat:实际的使用场景

   * 初步检索：当用户向RAG系统发出一个查询时，系统首先通过**检索模块（Retriever Module）**从外部知识库（如互联网、数据库或医学文献）中找到相关信息。
   * 调用记忆：与此同时，记忆模块会被激活，尝试从其存储的历史信息中检索与当前查询最相关的内容。这种“记忆检索”能补充和丰富外部检索的结果，尤其是对于需要长时间积累信息的场景。

4. `fusion模块`

   目的：整合多种信息来源并优化检索结果，从而生成更全面和相关性更强的回答。==它会利用多种检索策略，结合来自不同数据源的结果，智能地对信息进行融合与排序。==

   :chart_with_upwards_trend:实际的使用场景：一个医生希望了解某种慢性病的最新治疗方案，以及过去患者的治疗效果对比。

   1. 医生输入查询，如“某慢性病的最新治疗方案和相关患者反馈”。
   2. **检索模块**：向不同的医学数据库、文献库和患者反馈系统发送查询。
   3. **Fusion模块**：将从多个数据源（如最新的医学研究、临床试验结果、患者健康记录等）获取的信息融合在一起。将复杂和多样的检索结果整理成最优信息集，帮助快速获得高相关性和全面的答案。

   :black_joker:fusion模块与<u>检索模块</u>的协作过程 与<u>生成模块</u>的协作

   1. 检索模块获取初步结果

      检索模块会针对不同数据源（如文献库、知识库、医学数据库等）执行多次检索，返回来自不同来源的多组结果。

   2. Fusion模块接收并融合检索结果

      * Fusion模块会分析检索模块返回的多组结果，并展开多角度的分析。
      * Fusion模块会将这些来自不同数据源的检索结果进行**整合**。融合过程中，Fusion模块会根据信息的来源、相似度、上下文关联性等因素，智能地优化和筛选信息。它会消除冗余数据，将最重要、最相关的信息排列在前。
      * 为了确保信息的高质量，Fusion模块还会对融合后的结果进行重排序（rerank）。它会优先展示那些信息来源权威、与查询高度相关的数据，同时保留多样性，以覆盖不同的知识视角。

   3. 优化后的信息传递给生成模块

      Fusion模块将融合和优化后的信息集传递给**生成模块（Generator Module）**。生成模块使用这些信息生成连贯、准确的自然语言回答。

5. `router模块`

   Aim：确定查询应该使用哪些数据源或走哪些路径，确保系统能够高效、精准地获取和处理所需的信息

   :unicorn:工作机制

   Router模块会分析用户的查询，并根据查询的特性，选择最合适的处理路径。这种选择可以是基于：

   * **查询类型**：例如，是否是一个简单的事实性查询，还是一个需要综合分析的复杂问题。
   * **数据源优先级**：某些查询可能需要优先访问权威数据源，而另一些可能需要从用户生成的内容中获取信息。

   :taxi:工作流程

   1. **分析查询意图**：Router模块会首先对用户查询进行意图分析，确定查询属于哪个类别。例如，它可以区分出用户是在问一个<u>简单事实</u>，还是在寻求<u>深入分析</u>。

   2. **选择最优路径**：根据分析结果，Router模块会选择最合适的数据流路径。这可能包括：

      | 简单查询路径                                                 | 复杂查询路径                                                 |
      | ------------------------------------------------------------ | ------------------------------------------------------------ |
      | 对于简单的、直接的问题，Router模块可能会将查询直接发送到一个快速、可靠的知识库中进行检索。 | 对于需要多重数据整合的问题，Router模块可能会引导查询经过多个模块，如搜索多源信息，然后进行智能融合和重排序。 |
      |                                                              |                                                              |
      

### 多层次存储（Multi-Tiered Storage）

你的方案将数据划分为短期、中期和长期三种类型，对应SSE、MSE、LSE存储模块。这样的分级设计能显著提升数据访问速度和效率：短期数据可快速检索，中期数据定期更新，而长期数据则进行低频维护。

* SSE模块负责存储短时有效的信息，适用于临时上下文或高频变动的数据。它的运作模式类似于CPU缓存，主要处理的是时效性高但寿命短的数据。因此，如何有效管理SSE的容量并保证数据的快速更新和淘汰，是一个关键问题。
* MSE主要用于中等重要度的数据，这些数据在生成任务中有一定的使用周期但会被定期替换。你可以借鉴数据库中的缓存策略，如LRU（Least Recently Used）或LFU（Least Frequently Used），来提高数据的利用率和检索效率。
* LSE则适合存储稳定且有长期价值的信息，如核心知识库或背景信息。这一模块的运作模式相对简单，主要是持久化和低频更新，但要确保数据的一致性和稳定性。设计上可以考虑冗余存储和备份策略，以防止数据丢失。 

### 





